
> cortex-os@0.0.1 security:scan /Users/jamiecraik/.Cortex-OS
> cross-env NODE_OPTIONS="--max-old-space-size=2048" semgrep scan --config=.semgrep/owasp-precise.yaml --severity=ERROR . --max-memory=2048 --timeout 180 --max-target-bytes 200MB

               
               
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Scan Status â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  Scanning 6720 files tracked by git with 4 Code rules:
                                                                                                                        
  Language   Rules   Files          Origin   Rules                                                                      
 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                     
  ts             3    2557          Custom       4                                                                      
  python         4     269                                                                                              
  js             3     203                                                                                              
                                                                                                                        
                    
                    
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 64 Code Findings â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                            
    apps/cortex-os/tests/e2e/second-brain-validation.test.ts
   â¯â¯â± semgrep.owasp-top-10-2021-a10-server-side-request-forgery
          Potential Server-Side Request Forgery: Direct use of user input in HTTP requests
                                                                                          
           59â”† const toolsResponse = await fetch(`${runtime.mcpUrl}/tools`);
            â‹®â”†----------------------------------------
          133â”† const toolsResponse = await fetch(`${runtime.mcpUrl}/tools`);
            â‹®â”†----------------------------------------
          258â”† const toolsResponse = await fetch(`${runtime.mcpUrl}/tools`);
            â‹®â”†----------------------------------------
          294â”† const toolsResponse = await fetch(`${runtime.mcpUrl}/tools`);
            â‹®â”†----------------------------------------
          342â”† const toolsResponse = await fetch(`${runtime.mcpUrl}/tools`);
                                                   
    apps/cortex-os/tests/http/api-endpoints.test.ts
   â¯â¯â± semgrep.owasp-top-10-2021-a10-server-side-request-forgery
          Potential Server-Side Request Forgery: Direct use of user input in HTTP requests
                                                                                          
           75â”† const response = await fetch(`${runtime.httpUrl}/v1/tasks`);
                                              
    apps/cortex-os/tests/mcp/mcp-basic.test.ts
   â¯â¯â± semgrep.owasp-top-10-2021-a10-server-side-request-forgery
          Potential Server-Side Request Forgery: Direct use of user input in HTTP requests
                                                                                          
           25â”† const response = await fetch(`${runtime.mcpUrl}/tools`);
            â‹®â”†----------------------------------------
           37â”† const response = await fetch(`${runtime.mcpUrl}/tools`);
            â‹®â”†----------------------------------------
           59â”† const response = await fetch(`${runtime.mcpUrl}/tools`);
            â‹®â”†----------------------------------------
           77â”† const response = await fetch(`${runtime.mcpUrl}/nonexistent`);
            â‹®â”†----------------------------------------
           90â”† const response = await fetch(`${runtime.mcpUrl}/tools`);
                                                           
    apps/cortex-os/tests/mcp/mcp-server-integration.test.ts
   â¯â¯â± semgrep.owasp-top-10-2021-a10-server-side-request-forgery
          Potential Server-Side Request Forgery: Direct use of user input in HTTP requests
                                                                                          
           25â”† const response = await fetch(`${runtime.mcpUrl}/tools`);
            â‹®â”†----------------------------------------
          182â”† const response = await fetch(`${runtime.mcpUrl}/tools`);
            â‹®â”†----------------------------------------
          225â”† const response = await fetch(`${runtime.mcpUrl}/tools`);
                                                              
    apps/cortex-os/tests/runtime.bootstrap.integration.test.ts
   â¯â¯â± semgrep.owasp-top-10-2021-a10-server-side-request-forgery
          Potential Server-Side Request Forgery: Direct use of user input in HTTP requests
                                                                                          
           52â”† const res = await fetch(`${runtime.mcpUrl}/tools`);
                                                      
    apps/cortex-os/tests/runtime/basic-startup.test.ts
   â¯â¯â± semgrep.owasp-top-10-2021-a10-server-side-request-forgery
          Potential Server-Side Request Forgery: Direct use of user input in HTTP requests
                                                                                          
           73â”† const response = await fetch(`${runtime.mcpUrl}/tools`);
                                           
    apps/cortex-py/src/cortex_py/thermal.py
   â¯â¯â± semgrep.owasp-top-10-2021-a03-injection-command
          Potential Command Injection: Direct use of user input in system commands
                                                                                  
          200â”† completed = subprocess.run(
          201â”†     self._COMMAND,
          202â”†     check=True,
          203â”†     capture_output=True,
          204â”†     text=True,
          205â”†     timeout=3,
          206â”† )
            â‹®â”†----------------------------------------
          237â”† completed = subprocess.run(
          238â”†     self._COMMAND,
          239â”†     check=True,
          240â”†     capture_output=True,
          241â”†     text=True,
          242â”†     timeout=3,
          243â”† )
                                                   
    apps/cortex-py/src/cortex_py/thermal_monitor.py
   â¯â¯â± semgrep.owasp-top-10-2021-a03-injection-command
          Potential Command Injection: Direct use of user input in system commands
                                                                                  
           99â”† result = subprocess.run(
          100â”†     ["which", "powermetrics"], capture_output=True, text=True
          101â”† )
            â‹®â”†----------------------------------------
          106â”† result = subprocess.run(
          107â”†     ["which", "system_profiler"], capture_output=True, text=True
          108â”† )
            â‹®â”†----------------------------------------
          236â”† result = subprocess.run(
          237â”†     ["which", "sensors"], capture_output=True, text=True
          238â”† )
            â‹®â”†----------------------------------------
          392â”† result = subprocess.run(
          393â”†     [
          394â”†         "wmic",
          395â”†         "/namespace:\\\\root\\wmi",
          396â”†         "PATH",
          397â”†         "MSAcpi_ThermalZoneTemperature",
          398â”†         "get",
          399â”†         "CurrentTemperature",
          400â”†         "/format:list",
          401â”†     ],
             [hid 4 additional lines, adjust with --max-lines-per-finding] 
                                                        
    apps/cortex-py/tests/test_cortex_py_comprehensive.py
   â¯â¯â± semgrep.owasp-top-10-2021-a03-injection-command
          Potential Command Injection: Direct use of user input in system commands
                                                                                  
          214â”† result = subprocess.run(
          215â”†     [
          216â”†         sys.executable,
          217â”†         "-c",
          218â”†         f"import sys; sys.path.insert(0, '{SRC_ROOT}'); "
          219â”†         "from mlx.mlx_unified import main; "
          220â”†         "main(['--model', 'test-embedding', '--mode', 'embedding', '--text', 'hello'])",
          221â”†     ],
          222â”†     capture_output=True,
          223â”†     text=True,
             [hid 2 additional lines, adjust with --max-lines-per-finding] 
          240â”† result = subprocess.run(
          241â”†     [
          242â”†         sys.executable,
          243â”†         "-c",
          244â”†         f"import sys; sys.path.insert(0, '{SRC_ROOT}'); "
          245â”†         "from mlx.mlx_unified import main; "
          246â”†         "main(['--model', 'test-embedding', '--mode', 'embedding', '--text', 'hello', '--
               text', 'world'])",                                                                       
          247â”†     ],
          248â”†     capture_output=True,
          249â”†     text=True,
             [hid 2 additional lines, adjust with --max-lines-per-finding] 
          265â”† result = subprocess.run(
          266â”†     [
          267â”†         sys.executable,
          268â”†         "-c",
          269â”†         f"import sys; sys.path.insert(0, '{SRC_ROOT}'); "
          270â”†         "from mlx.mlx_unified import main; "
          271â”†         "main(['--model', 'test-chat', '--mode', 'chat', '--text', 'Hello!'])",
          272â”†     ],
          273â”†     capture_output=True,
          274â”†     text=True,
             [hid 2 additional lines, adjust with --max-lines-per-finding] 
          283â”† result = subprocess.run(
          284â”†     [
          285â”†         sys.executable,
          286â”†         "-c",
          287â”†         f"import sys; sys.path.insert(0, '{SRC_ROOT}'); "
          288â”†         "from mlx.mlx_unified import main; "
          289â”†         "main(['--model', 'test-rerank', '--mode', 'rerank', '--query', 'test query', '--
               text', 'doc1', '--text', 'doc2'])",                                                      
          290â”†     ],
          291â”†     capture_output=True,
          292â”†     text=True,
             [hid 2 additional lines, adjust with --max-lines-per-finding] 
                                   
    docker/gpl-tools/gpl_service.py
   â¯â¯â± semgrep.owasp-top-10-2021-a03-injection-command
          Potential Command Injection: Direct use of user input in system commands
                                                                                  
          159â”† result = subprocess.run(
          160â”†     cmd,
          161â”†     capture_output=True,
          162â”†     text=True,
          163â”†     timeout=30,
          164â”†     cwd=SAFE_IMAGE_DIR,  # Run in safe directory
          165â”†     shell=False,  # Security: prevent shell injection
          166â”† )
            â‹®â”†----------------------------------------
          275â”† result = subprocess.run(
          276â”†     [tool, "--version"], capture_output=True, text=True, timeout=5
          277â”† )
                                    
    docker/gpl-tools/health_check.py
   â¯â¯â± semgrep.owasp-top-10-2021-a03-injection-command
          Potential Command Injection: Direct use of user input in system commands
                                                                                  
           25â”† result = subprocess.run(
           26â”†     [tool, "--version"], capture_output=True, text=True, timeout=5
           27â”† )
                                     
    examples/local-memory-rest-api.ts
   â¯â¯â± semgrep.owasp-top-10-2021-a10-server-side-request-forgery
          Potential Server-Side Request Forgery: Direct use of user input in HTTP requests
                                                                                          
           82â”† const response = await fetch(`${this.baseUrl}/memories/${id}`);
            â‹®â”†----------------------------------------
           95â”† const response = await fetch(`${this.baseUrl}/memories/search?${params}`);
            â‹®â”†----------------------------------------
          201â”† const response = await fetch(`${this.baseUrl}/health`);
                                  
    examples/test-local-memory.mjs
   â¯â¯â± semgrep.owasp-top-10-2021-a10-server-side-request-forgery
          Potential Server-Side Request Forgery: Direct use of user input in HTTP requests
                                                                                          
           17â”† const healthResponse = await fetch(`${BASE_URL}/health`);
            â‹®â”†----------------------------------------
           50â”† const searchResponse = await fetch(`${BASE_URL}/memories/search?${searchParams}`);
            â‹®â”†----------------------------------------
           78â”† const apiResponse = await fetch(`${BASE_URL}/`);
                                                  
    libs/python/safe_subprocess/safe_subprocess.py
   â¯â¯â± semgrep.owasp-top-10-2021-a03-injection-command
          Potential Command Injection: Direct use of user input in system commands
                                                                                  
          167â”† return subprocess.run(
          168â”†     cmd_parts,
          169â”†     cwd=cwd,
          170â”†     timeout=timeout,
          171â”†     capture_output=capture_output,
          172â”†     text=text,
          173â”†     env=env,
          174â”†     check=check,
          175â”†     **kwargs,
          176â”† )
                                    
    packages/agents/test-endpoint.js
   â¯â¯â± semgrep.owasp-top-10-2021-a10-server-side-request-forgery
          Potential Server-Side Request Forgery: Direct use of user input in HTTP requests
                                                                                          
           26â”† const healthResponse = await fetch(`${baseUrl}/health`);
                                     
    packages/commands/src/adapters.ts
   â¯â¯â± semgrep.owasp-top-10-2021-a03-injection-code
          Potential Code Injection: Direct execution of user input as code
                                                                          
           68â”† const { stdout: branch } = await exec('git rev-parse --abbrev-ref HEAD');
            â‹®â”†----------------------------------------
           82â”† const { stdout } = await exec(cmd);
            â‹®â”†----------------------------------------
          106â”† const { stdout } = await exec(cmd);
            â‹®â”†----------------------------------------
          119â”† const { stdout } = await exec(cmd);
                                                 
    packages/memories/tests/health-report.test.ts
   â¯â¯â± semgrep.owasp-top-10-2021-a10-server-side-request-forgery
          Potential Server-Side Request Forgery: Direct use of user input in HTTP requests
                                                                                          
           99â”† const response = await fetch(url);
                                                 
    packages/prp-runner/src/lib/model-selector.ts
   â¯â¯â± semgrep.owasp-top-10-2021-a10-server-side-request-forgery
          Potential Server-Side Request Forgery: Direct use of user input in HTTP requests
                                                                                          
          165â”† const response = await fetch('http://localhost:11434/api/tags');
                                                
    packages/rag/__tests__/health-server.test.ts
   â¯â¯â± semgrep.owasp-top-10-2021-a10-server-side-request-forgery
          Potential Server-Side Request Forgery: Direct use of user input in HTTP requests
                                                                                          
            6â”† return fetch(url).then(async (r) => ({ status: r.status, body: await r.json() }));
            â‹®â”†----------------------------------------
           62â”† const res = await fetch(`${baseUrl}/nope`);
                                                     
    packages/testing/src/integration/mcp-http.test.ts
   â¯â¯â± semgrep.owasp-top-10-2021-a10-server-side-request-forgery
          Potential Server-Side Request Forgery: Direct use of user input in HTTP requests
                                                                                          
          204â”† const response = await fetch(`${baseUrl}/healthz`);
                                     
    scripts/__tests__/test_codemap.py
   â¯â¯â± semgrep.owasp-top-10-2021-a03-injection-command
          Potential Command Injection: Direct use of user input in system commands
                                                                                  
          119â”† subprocess.run(command, cwd=repo, check=True, capture_output=True, text=True)
            â‹®â”†----------------------------------------
          172â”† completed = subprocess.run(
          173â”†     command,
          174â”†     cwd=cwd or repo,
          175â”†     capture_output=True,
          176â”†     text=True,
          177â”†     check=False,
          178â”† )
            â‹®â”†----------------------------------------
          347â”† result = subprocess.run(
          348â”†     [
          349â”†         sys.executable,
          350â”†         str(script_path),
          351â”†         "--repo",
          352â”†         str(fixture_repo),
          353â”†         "--out",
          354â”†         str(json_path),
          355â”†         "--md",
          356â”†         str(md_path),
             [hid 10 additional lines, adjust with --max-lines-per-finding] 
                                 
    scripts/create_github_release
   â¯â¯â± semgrep.owasp-top-10-2021-a03-injection-command
          Potential Command Injection: Direct use of user input in system commands
                                                                                  
           98â”† result = subprocess.run(command, text=True, capture_output=True, input=json_payload)
                                           
    scripts/maintenance/fix-dependencies.py
   â¯â¯â± semgrep.owasp-top-10-2021-a03-injection-command
          Potential Command Injection: Direct use of user input in system commands
                                                                                  
           46â”† result = subprocess.run(
           47â”†     validated_cmd,
           48â”†     shell=False,
           49â”†     check=True,
           50â”†     capture_output=True,
           51â”†     text=True,
           52â”†     timeout=300  # 5 minute timeout
           53â”† )
                                            
    scripts/maintenance/install-mlx-tools.py
   â¯â¯â± semgrep.owasp-top-10-2021-a03-injection-command
          Potential Command Injection: Direct use of user input in system commands
                                                                                  
           23â”† subprocess.run(
           24â”†     cmd_list, shell=False, check=True, capture_output=True, text=True
           25â”† )
            â‹®â”†----------------------------------------
          103â”† result = subprocess.run(
          104â”†     cmd_list, shell=False, check=True, capture_output=True, text=True
          105â”† )
                             
    scripts/smoke-healthz.mjs
   â¯â¯â± semgrep.owasp-top-10-2021-a10-server-side-request-forgery
          Potential Server-Side Request Forgery: Direct use of user input in HTTP requests
                                                                                          
            6â”† const res = await fetch(`http://127.0.0.1:${port}/healthz`);
                             
    scripts/system/codemap.py
   â¯â¯â± semgrep.owasp-top-10-2021-a03-injection-command
          Potential Command Injection: Direct use of user input in system commands
                                                                                  
           87â”† completed = subprocess.run(
           88â”†     command,
           89â”†     cwd=cwd,
           90â”†     capture_output=True,
           91â”†     text=True,
           92â”†     check=False,
           93â”† )
                              
    servers/scripts/release.py
   â¯â¯â± semgrep.owasp-top-10-2021-a03-injection-command
          Potential Command Injection: Direct use of user input in system commands
                                                                                  
           53â”† subprocess.run(
           54â”†     [git_path, "rev-parse", "--verify", value],
           55â”†     check=True,
           56â”†     capture_output=True,
           57â”†     shell=False,  # Prevent shell injection
           58â”†     timeout=10,  # Prevent hanging
           59â”† )
            â‹®â”†----------------------------------------
          136â”† output = subprocess.run(
          137â”†     [git_path, "diff", "--name-only", git_hash, "--", "."],
          138â”†     cwd=path,
          139â”†     check=True,
          140â”†     capture_output=True,
          141â”†     text=True,
          142â”†     shell=False,  # Prevent shell injection
          143â”†     timeout=30,  # Prevent hanging
          144â”† )
                                                
    simple-tests/agent-isolation-sandbox.test.ts
   â¯â¯â± semgrep.owasp-top-10-2021-a03-injection-code
          Potential Code Injection: Direct execution of user input as code
                                                                          
          171â”† eval('1 + 2');
            â‹®â”†----------------------------------------
          223â”† eval('2+2');
            â‹®â”†----------------------------------------
          257â”† eval('2+2');
            â‹®â”†----------------------------------------
          298â”† eval('40+2');
                                               
    tests/memory/integration-validation.test.ts
   â¯â¯â± semgrep.owasp-top-10-2021-a10-server-side-request-forgery
          Potential Server-Side Request Forgery: Direct use of user input in HTTP requests
                                                                                          
          160â”† const healthResponse = await fetch(`${baseUrl}/healthz`);
            â‹®â”†----------------------------------------
          169â”† const readyResponse = await fetch(`${baseUrl}/readyz`);
                                         
    tools/model-convert/convert-to-mlx.py
   â¯â¯â± semgrep.owasp-top-10-2021-a03-injection-command
          Potential Command Injection: Direct use of user input in system commands
                                                                                  
           36â”† result = subprocess.run(
           37â”†     [mlxknife_path, "--version"],
           38â”†     capture_output=True,
           39â”†     text=True,
           40â”†     shell=False,  # Prevent shell injection
           41â”†     timeout=10,  # Prevent hanging
           42â”† )
                
                
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Scan Summary â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
âœ… Scan completed successfully.
 â€¢ Findings: 64 (64 blocking)
 â€¢ Rules run: 4
 â€¢ Targets scanned: 3029
 â€¢ Parsed lines: ~99.9%
 â€¢ Scan skipped: 
   â—¦ Files matching .semgrepignore patterns: 249
 â€¢ Scan was limited to files tracked by git
 â€¢ For a detailed list of skipped files and lines, run semgrep with the --verbose flag
Ran 4 rules on 3029 files: 64 findings.

A new version of Semgrep is available. See https://semgrep.dev/docs/upgrading

ğŸ“¢ Too many findings? Try Semgrep Pro for more powerful queries and less noise.
   See https://sg.run/false-positives.

